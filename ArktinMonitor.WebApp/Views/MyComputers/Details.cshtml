@using Newtonsoft.Json
@model ArktinMonitor.Data.Models.ComputerViewModel
@{
    ViewBag.Title = "My computers";
}

<h2 id="details-header">Details</h2>

<div class="row">
    <div class="col-md-5">

        <div id="computer-details" class="card-dark">
            <h3 class="arktinHeader">
                @Model.Name&nbsp;
                <svg style="width:20px;height:20px" viewBox="0 0 20 20">
                    <path id="connection-icon" fill="#FFFFFF" d="M20,4H14V10L16.24,7.76C17.32,8.85 18,10.34 18,12C18,13 17.75,13.94 17.32,14.77L18.78,16.23C19.55,15 20,13.56 20,12C20,9.79 19.09,7.8 17.64,6.36L20,4M2.86,5.41L5.22,7.77C4.45,9 4,10.44 4,12C4,14.21 4.91,16.2 6.36,17.64L4,20H10V14L7.76,16.24C6.68,15.15 6,13.66 6,12C6,11 6.25,10.06 6.68,9.23L14.76,17.31C14.5,17.44 14.26,17.56 14,17.65V19.74C14.79,19.53 15.54,19.2 16.22,18.78L18.58,21.14L19.85,19.87L4.14,4.14L2.86,5.41M10,6.35V4.26C9.2,4.47 8.45,4.8 7.77,5.22L9.23,6.68C9.5,6.56 9.73,6.44 10,6.35Z" />
                </svg>
            </h3>
            <p>@Model.OperatingSystem</p>
            <p>@Model.Cpu</p>
            <p>@Model.Ram GB</p>
            <p>@Model.Gpu</p>
            <p>@Model.MacAddress</p>
        </div>
    </div>

    <div class="col-md-3">
        <div id="users" class="card-dark">
            <h4 class="arktinHeader">@Html.ActionLink("Users", "Users", "MyComputers")</h4>
            @foreach (var user in Model.ComputerUsers)
            {
                <div class="user" id="user-@user.Name.ToLower()">
                    <p class="username-over-progress" data-toggle="tooltip" title="No data">@user.FullName</p>
                    <div class="my-progress">
                        <div class="progress-active" style="width: 0%; background: orange" data-toggle="tooltip" title="fuck"></div>
                        <div class="progress-idle" style="width: 0%; background: coral" data-toggle="tooltip" title="fuck"></div>
                        <div class="progress-background" style="width: 100%; background: #393939"></div>
                    </div>
                </div>
            }
        </div>
    </div>
    <div class="col-md-4">

        <div id="disks" class="card-dark">
            <h4 class="arktinHeader">Disks</h4>
            @foreach (var disk in Model.Disks)
            {
                <p>
                    @disk.Name (@disk.Letter.Replace("\\", ""))
                    @disk.FreeSpaceInGigaBytes.ToString("0.00") GB free of @disk.TotalSpaceInGigaBytes.ToString("0") GB
                </p>
            }
        </div>
    </div>
    <div class="col-md-4">
        <div id="div-tts" class="card-dark">
            <h4 id="language" title="Click here to change language">Voice message</h4>
            <input type="text" class="form-control" placeholder="Send TTS message to computer" id="tts-message">
        </div>
    </div>
    <div class="col-md-12">
        <div id="div-graph" class="card-dark">

            <canvas id="graph" width="0" height="0"
                    style="border: 1px solid gray; border: 1px solid rgba(255,255,255,0.3)">
                Your browser does not support the HTML5 canvas tag.
            </canvas>
        </div>
    </div>

    <script type="text/javascript">
        var logs = @Html.Raw(JsonConvert.SerializeObject(Model.LogTimeIntervals, Formatting.Indented,
                       new JsonSerializerSettings{DateFormatHandling = DateFormatHandling.IsoDateFormat}));
    </script>
    <script src="/Scripts/arktin/graph.js" type="text/javascript"></script>
</div>
@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $("#language").click(function() {
            $("body").data("language",prompt("Enter language code, (e.g., pl-PL, en-US)",""));
        });
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var hubConnection = $.connection.myComputerHub;
            hubConnection.client.pong = function (id) {
                // Add the message to the page.
                if (id == window.location.pathname.split("/").pop()) {
                    //$("#details-header").text("Pong");
                    $("#connection-icon").attr("d",
                        "M12,18A6,6 0 0,1 6,12C6,11 6.25,10.03 6.7,9.2L5.24,7.74C4.46,8.97 4,10.43 4,12A8,8 0 0,0 12,20V23L16,19L12,15M12,4V1L8,5L12,9V6A6,6 0 0,1 18,12C18,13 17.75,13.97 17.3,14.8L18.76,16.26C19.54,15.03 20,13.57 20,12A8,8 0 0,0 12,4Z");
                }
            };
            // Start the connection.
            $.connection.hub.start().done(function () {
                $("#computer-details").click(checkSignalrConnection ());
                checkSignalrConnection();
                $("#tts-message").keypress(function (e) {
                    if (e.which == 13) {
                        //alert($("body").data("language"));
                        var lang = $("body").data("language");
                        //if (lang == undefined) {
                        //    lang = "en-US";
                        //}
                        hubConnection.server.fart(window.location.pathname.split("/").pop(), $("#tts-message").val(), lang);
                        return false;    //<---- Add this line
                    }
                });

                function checkSignalrConnection () {
                    // Call the Send method on the hub.
                    $("#connection-icon").attr("d",
                        "M20,4H14V10L16.24,7.76C17.32,8.85 18,10.34 18,12C18,13 17.75,13.94 17.32,14.77L18.78,16.23C19.55,15 20,13.56 20,12C20,9.79 19.09,7.8 17.64,6.36L20,4M2.86,5.41L5.22,7.77C4.45,9 4,10.44 4,12C4,14.21 4.91,16.2 6.36,17.64L4,20H10V14L7.76,16.24C6.68,15.15 6,13.66 6,12C6,11 6.25,10.06 6.68,9.23L14.76,17.31C14.5,17.44 14.26,17.56 14,17.65V19.74C14.79,19.53 15.54,19.2 16.22,18.78L18.58,21.14L19.85,19.87L4.14,4.14L2.86,5.41M10,6.35V4.26C9.2,4.47 8.45,4.8 7.77,5.22L9.23,6.68C9.5,6.56 9.73,6.44 10,6.35Z");
                    hubConnection.server.ping(window.location.pathname.split("/").pop());
                }
            });
        });
        //$(document).ready(updateToolTips());

        function updateToolTips() {
            $('[data-toggle="tooltip"]').tooltip();
        }


    </script>
}